{% extends 'base.html' %}
{% block body %}
<div class="container mt-5">
    <div class="row">
        <div class="col-md-6">
            <img src="{{ movie.poster.url }}" class="img-fluid mb-3" alt="Movie Poster" style="width: 400px; height: 600px;">
        </div>
        <div class="col-md-6">
            <h1 class="h2 mb-4">{{ movie.title }}
                <span style="font-size: 20px; margin-left: 10px;">
                    <i class="fas fa-star" style="color: gold;"></i> {{ movie.rating }} / 5
                </span>
            </h1>
            <h2 class="h4"><strong>Description:</strong></h2>
            <div id="description-container" style="overflow-y: auto; max-height: 250px;">
                <p class="lead" id="description">{{ movie.description }}</p>
            </div>
            <br>
            <h2 class="h4"><strong>Genre:</strong></h2>
            <p class="lead">{{ movie.category }}</p>
            <h2 class="h4"><strong>Release Date:</strong></h2>
            <p class="lead">{{ movie.release_date }}</p>
            <h2 class="h4"><strong>Actors:</strong></h2>
            <p class="lead">{{ movie.actors }}</p>
            <a href="{{ movie.trailer }}"><button type="button" class="btn btn-primary btn-lg mt-3">Watch Trailer</button></a>
            <a href="{% url 'main:ratemovie' movie.id %}"><button type="button" class="btn btn-warning btn-lg mt-3">Rate this movie</button></a>
        </div>
    </div>
    <div class="row mt-5">
        <div class="col-md-12">
            <h2 class="h2 mb-4">User Reviews</h2>
            <!-- Review submission form -->
            {% if user.is_authenticated %}
            <form method="post" action="{% url 'main:reviewmovie' movie.id %}"> {% csrf_token %}
                <div class="form-group">
                    <textarea class="form-control" name="review" rows="4" placeholder="Write your review here" required></textarea>
                </div>
                <div class="form-group text-right">
                    <button type="submit" class="btn btn-primary btn-sm right">Submit Review</button>
                </div>
            </form>
            {% else %}
            <div class="alert alert-warning" role="alert">
                You must be logged in to review.
                <a href="{% url 'main:login' %}" class="btn btn-primary btn-sm ml-2">Login</a>
            </div>
            {% endif %}
            <!-- Display reviews -->
            <div class="mt-4">
                <div class="card">
                    <div class="card-body">
                        <div class="media">
                            <img src="avatar_url_placeholder" class="mr-3 rounded-circle" alt="User Avatar" style="width: 64px; height: 64px;">
                            <div class="media-body">
                                <h5 class="mt-0">Username Placeholder</h5>
                                <p>Review Content Placeholder</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</div>

<script>
    // Limit description to 250 words
    let description = document.getElementById('description').innerText;
    let words = description.split(' ');
    if (words.length > 250) {
        words = words.slice(0, 250);
        document.getElementById('description').innerText = words.join(' ') + '...';
    }
</script>

{% endblock %}
